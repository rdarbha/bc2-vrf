{% set switchvars = interfaces[ansible_hostname] %}

# /etc/network/interfaces template for switches ({{ansible_hostname}})
# Created by Ansible

# {{ switchvars }}

{% if switchvars["vrf"] is defined %}
{% for vrfvars in switchvars["vrf"] %}
auto {{ vrfvars }}
iface {{ vrfvars }}
  vrf-table auto
{% endfor %}
{% endif %}

auto lo
iface lo inet loopback
  address {{ switchvars.loopback }}

auto eth0
iface eth0 inet dhcp


{% if switchvars.fabric is defined %}
{% set fabricvars = switchvars.fabric %}
# fabricvars = {{ fabricvars }}
{% for intvars in fabricvars %}
# intvar = {{ intvars }}
auto {{ intvars }}
iface {{ intvars }}
{% if intvars.vrf is defined %}
  vrf {{ intvars.vrf }}
{% endif %}
{% if intvars.address is defined %}
  address {{intvars.address}}
{% endif %}
{% endfor %}
{% endif %}

{% if switchvars.neighbors is defined %}
{% set neighborvars = switchvars.neighbors %}
{% for intvars in neighborvars %}
auto {{ intvars }}
iface {{ intvars }}
{% if intvars.vrf is defined %}
  vrf {{intvars.vrf}}
{% endif %}
{% if intvars.address is defined %}
  address {{intvars.address}}
{% endif %}
{% endfor %}
{% endif %}