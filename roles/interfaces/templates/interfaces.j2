{% set intvars = interfaces[ansible_hostname] %}

# /etc/network/interfaces template for switches ({{ansible_hostname}})
# Created by Ansible

# {{ intvars }}

{% if intvars.vrf is defined %}
{% for vrf in intvars.vrf %}
auto {{vrf}}
iface {{vrf}}
  vrf-table auto
{% endfor %}
{% endif %}

auto lo
iface lo inet loopback
  address {{ intvars.loopback }}

auto eth0
iface eth0 inet dhcp


{% if intvars.fabric is defined %}
{% for iface in intvars.fabric %}
auto {{ iface }}
iface {{ iface }}
# iface.vrf = {{iface.vrf}}
{% if iface.vrf is defined %}
  vrf {{iface.vrf}}
{% endif %}
# iface.address = {{iface.address}}
{% if iface.address is defined %}
  address {{iface.address}}
{% endif %}
{% endfor %}
{% endif %}

{% if intvars.neighbors is defined %}
{% for iface in intvars.neighbors %}
auto {{ iface }}
iface {{ iface }}
# iface.vrf = {{iface.vrf}}
{% if iface.vrf is defined %}
  vrf {{iface.vrf}}
{% endif %}
# iface.address = {{iface.address}}
{% if iface.address is defined %}
  address {{iface.address}}
{% endif %}
{% endfor %}
{% endif %}